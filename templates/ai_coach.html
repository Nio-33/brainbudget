{% extends "base.html" %}

{% block title %}AI Coach - BrainBudget{% endblock %}

{% block content %}
<!-- AI Coach Page -->
<div class="min-h-screen" style="background-color: #EFDFC5;">
    <!-- Navigation Header -->
    <header class="absolute top-4 left-4 right-4 z-10 animate-fadeIn">
        <div class="flex justify-between items-center">
            <div class="flex space-x-8">
                <a href="/home" class="flex items-center space-x-2 hover:opacity-80 transition-colors" style="color: #252B2B;">
                    <span>🏠</span>
                    <span>Home</span>
                </a>
            </div>
            <div class="flex items-center space-x-4">
                <!-- Navigation links removed - only on homepage -->
            </div>
        </div>
    </header>

    <!-- Header Section -->
    <div class="relative py-16 px-4">
        <div class="max-w-6xl mx-auto text-center">
            <div class="mb-6">
                <span class="text-6xl">🤖</span>
            </div>
            <div class="inline-block px-8 py-4 rounded-full brain-gradient mb-6">
                <h1 class="text-4xl md:text-5xl font-bold text-white">
                    AI Coach
                </h1>
            </div>
            <p class="text-lg max-w-2xl mx-auto leading-relaxed" style="color: #252B2B;">
                Personal financial coaching that understands ADHD challenges and strengths. Get support, accountability, and guidance tailored to your neurodivergent brain.
            </p>
        </div>
    </div>

    <!-- AI Coach Content -->
    <div class="py-12 px-4">
        <div class="max-w-6xl mx-auto">
            <!-- Chat Interface -->
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <!-- Main Chat Area -->
                <div class="lg:col-span-3">
                    <div class="backdrop-blur-sm rounded-3xl p-6 h-[600px] flex flex-col" style="background-color: rgba(255, 255, 255, 0.9); border: 1px solid #380F17;">
                        <!-- Chat Header -->
                        <div class="flex items-center justify-between mb-6 pb-4 border-b" style="border-color: rgba(56, 15, 23, 0.1);">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 rounded-full flex items-center justify-center brain-gradient">
                                    <span class="text-white text-xl">🤖</span>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold" style="color: #380F17;">ADHD Financial Coach</h3>
                                    <p class="text-sm" style="color: #4C4F54;" id="coach-status">Ready to help with your finances</p>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="startNewConversation()" class="px-4 py-2 rounded-lg font-semibold transition-colors" style="background-color: #380F17; color: #EFDFC5;">
                                    🔄 New Chat
                                </button>
                                <button onclick="showHistory()" class="px-4 py-2 rounded-lg font-semibold transition-colors" style="background-color: #4C4F54; color: #EFDFC5;">
                                    📚 History
                                </button>
                            </div>
                        </div>

                        <!-- Messages Area -->
                        <div id="messages-container" class="flex-1 overflow-y-auto space-y-4 mb-6">
                            <!-- Welcome Message -->
                            <div class="flex items-start space-x-3">
                                <div class="w-10 h-10 rounded-full flex items-center justify-center brain-gradient">
                                    <span class="text-white text-sm">🤖</span>
                                </div>
                                <div class="flex-1 p-4 rounded-2xl" style="background-color: rgba(239, 223, 197, 0.8);">
                                    <p class="text-sm font-semibold mb-2" style="color: #380F17;">Your AI Coach</p>
                                    <p style="color: #252B2B;">Hi there! I'm your ADHD-aware financial coach. I understand the unique challenges and strengths that come with having a neurodivergent brain. How can I help you today?</p>
                                    <div class="mt-3 flex flex-wrap gap-2">
                                        <button onclick="sendQuickMessage('Help me budget with ADHD')" class="px-3 py-1 rounded-lg text-xs font-semibold transition-colors" style="background-color: #380F17; color: #EFDFC5;">
                                            💰 ADHD Budgeting
                                        </button>
                                        <button onclick="sendQuickMessage('I made an impulse purchase')" class="px-3 py-1 rounded-lg text-xs font-semibold transition-colors" style="background-color: #8F0B13; color: #EFDFC5;">
                                            🛒 Impulse Purchase Help
                                        </button>
                                        <button onclick="sendQuickMessage('Struggling with executive function')" class="px-3 py-1 rounded-lg text-xs font-semibold transition-colors" style="background-color: #252B2B; color: #EFDFC5;">
                                            🧠 Executive Function
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Sample conversation for demo -->
                            <div id="demo-messages" class="space-y-4">
                                <!-- User message -->
                                <div class="flex items-start space-x-3 justify-end">
                                    <div class="flex-1 max-w-xs p-4 rounded-2xl" style="background-color: rgba(56, 15, 23, 0.1);">
                                        <p style="color: #252B2B;">I keep forgetting to check my budget and then overspend. It's so frustrating!</p>
                                    </div>
                                    <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background-color: #8F0B13;">
                                        <span class="text-white text-sm">👤</span>
                                    </div>
                                </div>

                                <!-- AI Coach response -->
                                <div class="flex items-start space-x-3">
                                    <div class="w-10 h-10 rounded-full flex items-center justify-center brain-gradient">
                                        <span class="text-white text-sm">🤖</span>
                                    </div>
                                    <div class="flex-1 p-4 rounded-2xl" style="background-color: rgba(239, 223, 197, 0.8);">
                                        <p class="text-sm font-semibold mb-2" style="color: #380F17;">Your AI Coach</p>
                                        <p style="color: #252B2B;">I completely understand! This is so common with ADHD - our brains aren't wired for routine tasks like budget checking. Let's create some ADHD-friendly strategies:</p>
                                        <div class="mt-3 space-y-2">
                                            <div class="p-2 rounded-lg" style="background-color: rgba(56, 15, 23, 0.1);">
                                                <p class="text-sm font-semibold" style="color: #380F17;">🔔 Smart Reminders</p>
                                                <p class="text-xs" style="color: #4C4F54;">Set up gentle budget notifications when you're near spending limits</p>
                                            </div>
                                            <div class="p-2 rounded-lg" style="background-color: rgba(56, 15, 23, 0.1);">
                                                <p class="text-sm font-semibold" style="color: #380F17;">📱 Dopamine Triggers</p>
                                                <p class="text-xs" style="color: #4C4F54;">Use visual cues and celebrations to make budget checking rewarding</p>
                                            </div>
                                            <div class="p-2 rounded-lg" style="background-color: rgba(56, 15, 23, 0.1);">
                                                <p class="text-sm font-semibold" style="color: #380F17;">⚡ Executive Function Support</p>
                                                <p class="text-xs" style="color: #4C4F54;">Break budget management into tiny, specific steps</p>
                                            </div>
                                        </div>
                                        <p class="mt-3 text-sm" style="color: #252B2B;">Would you like me to help you set up any of these strategies?</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Input Area -->
                        <div class="border-t pt-4" style="border-color: rgba(56, 15, 23, 0.1);">
                            <div class="flex space-x-3">
                                <input 
                                    type="text" 
                                    id="user-input" 
                                    placeholder="Ask your AI coach anything about managing money with ADHD..."
                                    class="flex-1 p-3 rounded-xl border focus:outline-none focus:ring-2"
                                    style="border-color: #380F17; focus:ring-color: #380F17;"
                                    onkeypress="handleKeyPress(event)"
                                >
                                <button 
                                    onclick="sendMessage()" 
                                    class="px-6 py-3 rounded-xl font-semibold transition-colors brain-gradient text-white hover:shadow-lg"
                                >
                                    Send
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Sidebar -->
                <div class="space-y-6">
                    <!-- Coach Specialties -->
                    <div class="backdrop-blur-sm rounded-3xl p-6" style="background-color: rgba(255, 255, 255, 0.9); border: 1px solid #380F17;">
                        <h3 class="text-xl font-bold mb-4 flex items-center" style="color: #380F17;">
                            <span class="mr-3 text-2xl">🎯</span>
                            I Specialize In
                        </h3>
                        <div class="space-y-3 text-sm">
                            <div class="flex items-center space-x-3 p-2 rounded-lg" style="background-color: rgba(239, 223, 197, 0.6);">
                                <span class="text-lg">🧠</span>
                                <span style="color: #380F17;">ADHD budgeting strategies</span>
                            </div>
                            <div class="flex items-center space-x-3 p-2 rounded-lg" style="background-color: rgba(239, 223, 197, 0.6);">
                                <span class="text-lg">⚡</span>
                                <span style="color: #380F17;">Executive function support</span>
                            </div>
                            <div class="flex items-center space-x-3 p-2 rounded-lg" style="background-color: rgba(239, 223, 197, 0.6);">
                                <span class="text-lg">🛒</span>
                                <span style="color: #380F17;">Impulse purchase management</span>
                            </div>
                            <div class="flex items-center space-x-3 p-2 rounded-lg" style="background-color: rgba(239, 223, 197, 0.6);">
                                <span class="text-lg">🎉</span>
                                <span style="color: #380F17;">Dopamine-driven motivation</span>
                            </div>
                            <div class="flex items-center space-x-3 p-2 rounded-lg" style="background-color: rgba(239, 223, 197, 0.6);">
                                <span class="text-lg">📊</span>
                                <span style="color: #380F17;">Goal flexibility & adaptation</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="backdrop-blur-sm rounded-3xl p-6" style="background-color: rgba(255, 255, 255, 0.9); border: 1px solid #380F17;">
                        <h3 class="text-xl font-bold mb-4 flex items-center" style="color: #380F17;">
                            <span class="mr-3 text-2xl">⚡</span>
                            Quick Help
                        </h3>
                        <div class="space-y-3">
                            <button onclick="sendQuickMessage('Help me create an ADHD-friendly budget')" class="w-full p-3 rounded-xl font-semibold transition-colors hover:shadow-md text-left" style="background-color: #380F17; color: #EFDFC5;">
                                💰 Budget Setup
                            </button>
                            <button onclick="sendQuickMessage('I just made an impulse purchase and feel guilty')" class="w-full p-3 rounded-xl font-semibold transition-colors hover:shadow-md text-left" style="background-color: #8F0B13; color: #EFDFC5;">
                                🛍️ Impulse Purchase Support
                            </button>
                            <button onclick="sendQuickMessage('How can I remember to check my spending?')" class="w-full p-3 rounded-xl font-semibold transition-colors hover:shadow-md text-left" style="background-color: #252B2B; color: #EFDFC5;">
                                🔔 Memory Strategies
                            </button>
                        </div>
                    </div>

                    <!-- Conversation History -->
                    <div class="backdrop-blur-sm rounded-3xl p-6" style="background-color: rgba(255, 255, 255, 0.9); border: 1px solid #380F17;">
                        <h3 class="text-xl font-bold mb-4 flex items-center" style="color: #380F17;">
                            <span class="mr-3 text-2xl">📚</span>
                            Recent Topics
                        </h3>
                        <div class="space-y-2 text-sm">
                            <div class="p-2 rounded-lg cursor-pointer hover:shadow-md transition-colors" style="background-color: rgba(239, 223, 197, 0.6);">
                                <p class="font-semibold" style="color: #380F17;">Emergency Fund Strategy</p>
                                <p class="text-xs" style="color: #4C4F54;">Yesterday • 15 min conversation</p>
                            </div>
                            <div class="p-2 rounded-lg cursor-pointer hover:shadow-md transition-colors" style="background-color: rgba(239, 223, 197, 0.6);">
                                <p class="font-semibold" style="color: #380F17;">Hyperfocus Spending</p>
                                <p class="text-xs" style="color: #4C4F54;">3 days ago • 8 min conversation</p>
                            </div>
                            <div class="p-2 rounded-lg cursor-pointer hover:shadow-md transition-colors" style="background-color: rgba(239, 223, 197, 0.6);">
                                <p class="font-semibold" style="color: #380F17;">Grocery Budget Tips</p>
                                <p class="text-xs" style="color: #4C4F54;">1 week ago • 12 min conversation</p>
                            </div>
                        </div>
                    </div>

                    <!-- ADHD Support Widget -->
                    <div class="backdrop-blur-sm rounded-3xl p-6" style="background-color: rgba(56, 15, 23, 0.9); color: #EFDFC5;">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <span class="mr-3 text-2xl">💜</span>
                            ADHD-Friendly Reminder
                        </h3>
                        <div class="text-sm leading-relaxed">
                            <p class="mb-3">🧠 <strong>Your Brain is Different, Not Broken:</strong> ADHD brains are wired for interest, not importance.</p>
                            <p class="text-xs opacity-80">Financial management can be challenging with ADHD, but that doesn't mean you can't succeed. I'm here to help you work WITH your brain, not against it.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="py-8 text-center animate-fadeIn">
        <div class="max-w-4xl mx-auto px-4">
            <p class="text-sm" style="color: #4C4F54;">
                BrainBudget - Making budgeting accessible | powered by <span class="font-semibold" style="color: #8F0B13;">Niostudio</span>
            </p>
        </div>
    </footer>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize chat interface
    initializeChat();
    
    // Load conversation history
    loadConversationHistory();
    
    function initializeChat() {
        // Set up chat functionality
        const messagesContainer = document.getElementById('messages-container');
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    function loadConversationHistory() {
        // Load recent conversations
        fetch('/api/coach/conversations')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateConversationHistory(data.conversations);
                }
            })
            .catch(error => {
                console.log('Using demo conversation history');
            });
    }
    
    function updateConversationHistory(conversations) {
        console.log('Conversation history loaded:', conversations);
    }
    
    // Chat functions
    window.sendMessage = function() {
        const input = document.getElementById('user-input');
        const message = input.value.trim();
        
        if (!message) return;
        
        // Add user message to chat
        addUserMessage(message);
        
        // Clear input
        input.value = '';
        
        // Show typing indicator
        showTypingIndicator();
        
        // Send to AI coach (simulate for demo)
        setTimeout(() => {
            hideTypingIndicator();
            addCoachResponse(generateCoachResponse(message));
        }, 1500 + Math.random() * 1000);
    };
    
    window.sendQuickMessage = function(message) {
        document.getElementById('user-input').value = message;
        sendMessage();
    };
    
    window.handleKeyPress = function(event) {
        if (event.key === 'Enter') {
            sendMessage();
        }
    };
    
    function addUserMessage(message) {
        const messagesContainer = document.getElementById('messages-container');
        const messageElement = document.createElement('div');
        messageElement.className = 'flex items-start space-x-3 justify-end';
        messageElement.innerHTML = `
            <div class="flex-1 max-w-xs p-4 rounded-2xl" style="background-color: rgba(56, 15, 23, 0.1);">
                <p style="color: #252B2B;">${message}</p>
            </div>
            <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background-color: #8F0B13;">
                <span class="text-white text-sm">👤</span>
            </div>
        `;
        messagesContainer.appendChild(messageElement);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    function addCoachResponse(response) {
        const messagesContainer = document.getElementById('messages-container');
        const messageElement = document.createElement('div');
        messageElement.className = 'flex items-start space-x-3';
        messageElement.innerHTML = `
            <div class="w-10 h-10 rounded-full flex items-center justify-center brain-gradient">
                <span class="text-white text-sm">🤖</span>
            </div>
            <div class="flex-1 p-4 rounded-2xl" style="background-color: rgba(239, 223, 197, 0.8);">
                <p class="text-sm font-semibold mb-2" style="color: #380F17;">Your AI Coach</p>
                <p style="color: #252B2B;">${response}</p>
            </div>
        `;
        messagesContainer.appendChild(messageElement);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    function showTypingIndicator() {
        const messagesContainer = document.getElementById('messages-container');
        const typingElement = document.createElement('div');
        typingElement.id = 'typing-indicator';
        typingElement.className = 'flex items-start space-x-3';
        typingElement.innerHTML = `
            <div class="w-10 h-10 rounded-full flex items-center justify-center brain-gradient">
                <span class="text-white text-sm">🤖</span>
            </div>
            <div class="flex-1 p-4 rounded-2xl" style="background-color: rgba(239, 223, 197, 0.8);">
                <p class="text-sm font-semibold mb-2" style="color: #380F17;">Your AI Coach</p>
                <div class="flex space-x-1">
                    <div class="w-2 h-2 rounded-full animate-pulse" style="background-color: #380F17;"></div>
                    <div class="w-2 h-2 rounded-full animate-pulse" style="background-color: #380F17; animation-delay: 0.2s;"></div>
                    <div class="w-2 h-2 rounded-full animate-pulse" style="background-color: #380F17; animation-delay: 0.4s;"></div>
                </div>
            </div>
        `;
        messagesContainer.appendChild(typingElement);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    function hideTypingIndicator() {
        const typingIndicator = document.getElementById('typing-indicator');
        if (typingIndicator) {
            typingIndicator.remove();
        }
    }
    
    function generateCoachResponse(userMessage) {
        const responses = [
            "I understand how challenging money management can be with ADHD. Let's work together to find strategies that work with your brain, not against it. What specific area would you like to focus on first?",
            "That's such a common experience for people with ADHD! Your brain is wired differently, and traditional budgeting advice often doesn't account for that. Let me suggest some neurodivergent-friendly approaches...",
            "I hear the frustration in your message, and I want you to know that's completely valid. ADHD brains have unique strengths too - like creativity and hyperfocus - that we can leverage for your financial goals.",
            "Great question! ADHD affects executive function, which makes tasks like budgeting feel overwhelming. Let's break this down into smaller, more manageable steps that work with your brain.",
            "You're not alone in this struggle. Many people with ADHD face similar challenges with money management. The key is finding systems that provide the right amount of stimulation and structure for your brain."
        ];
        
        return responses[Math.floor(Math.random() * responses.length)];
    }
    
    // Additional functions
    window.startNewConversation = function() {
        document.getElementById('messages-container').innerHTML = `
            <div class="flex items-start space-x-3">
                <div class="w-10 h-10 rounded-full flex items-center justify-center brain-gradient">
                    <span class="text-white text-sm">🤖</span>
                </div>
                <div class="flex-1 p-4 rounded-2xl" style="background-color: rgba(239, 223, 197, 0.8);">
                    <p class="text-sm font-semibold mb-2" style="color: #380F17;">Your AI Coach</p>
                    <p style="color: #252B2B;">Hi! I'm here to help you navigate financial management with your ADHD brain. What's on your mind today?</p>
                </div>
            </div>
        `;
        showSuccessToast('🔄 Started new conversation with your AI coach!');
    };
    
    window.showHistory = function() {
        showSuccessToast('📚 Conversation history coming soon! You\'ll be able to review and continue previous coaching sessions.');
    };
    
    // Auto-focus on input when page loads
    setTimeout(() => {
        document.getElementById('user-input').focus();
    }, 1000);
});
</script>
{% endblock %}